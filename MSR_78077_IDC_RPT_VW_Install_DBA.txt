QL> show user
USER is "DEPLOY_USER"
SQL> select sysdate from dual;

SYSDATE
---------
05-JAN-22

SQL> select * from global_name;

GLOBAL_NAME
--------------------------------------------------------------------------------
OPSTST1.HR.STATE.SBU

SQL> @MSR_78077_IDC_RPT_VW_Install_DBA




SQL> SET SERVEROUTPUT ON
SQL> 
SQL> 
SQL>   CREATE OR REPLACE FORCE EDITIONABLE VIEW "KC_ETL_USER"."RPT_IDC_PSA_PSC_VW" ("DEPTID", "POST_DESC", "POSITION_NBR", "POSITION_TITLE", "TYPE", "EFM") AS
  2    SELECT DISTINCT
  3  J.DEPTID
  4  ,E.DESCR AS POST_DESC
  5  ,J.POSITION_NBR
  6  ,C.DESCR AS POSITION_TITLE
  7  ,P.OP_EMPL_MECHANISM AS TYPE
  8  ,D.OP_EFM_IND AS EFM
  9  FROM
 10  SYSADM.PS_JOB J
 11  ,SYSADM.PS_op_JOB P
 12  ,SYSADM.PS_POSITION_DATA C
 13  ,SYSADM.PS_OP_POSITION_DAT D
 14  ,SYSADM.PS_DEPT_TBL E
 15   WHERE  J.EFFDT = (
 16   SELECT MAX (A_ED.EFFDT)
 17    FROM SYSADM.PS_JOB A_ED
 18   WHERE J.EMPLID = A_ED.EMPLID
 19  	AND A_ED.EFFDT <= SYSDATE
 20  	)
 21  	AND J.EFFSEQ = (
 22   SELECT MAX (A_ES.EFFSEQ)
 23    FROM SYSADM.PS_JOB A_ES
 24   WHERE J.EMPLID = A_ES.EMPLID
 25  	AND J.EFFDT = A_ES.EFFDT
 26  	)
 27  	AND J.EMPLID = P.EMPLID
 28  	AND J.EMPL_RCD = P.EMPL_RCD
 29  	AND J.EFFDT = P.EFFDT
 30  	AND J.EFFSEQ = P.EFFSEQ
 31    AND J.EMPL_RCD = '1'
 32  	AND D.EFFDT = (
 33   SELECT MAX (D_ED.EFFDT)
 34    FROM SYSADM.PS_OP_POSITION_DAT D_ED
 35   WHERE D.POSITION_NBR = D_ED.POSITION_NBR
 36  	AND D_ED.EFFDT <= SYSDATE)
 37  	AND D.AGENCY = 'ST'
 38  	AND J.POSITION_NBR = D.POSITION_NBR
 39  	AND C.POSITION_NBR = D.POSITION_NBR
 40  	AND D.EFFDT = C.EFFDT
 41  	AND E.EFFDT = (
 42   SELECT MAX (E_ED.EFFDT)
 43    FROM SYSADM.PS_DEPT_TBL E_ED
 44   WHERE E.DEPTID = E_ED.DEPTID
 45  	AND E_ED.EFFDT <= SYSDATE)
 46  	AND J.DEPTID = E.DEPTID
 47  	AND E.SETID = 'SHARE'
 48  	AND J.BUSINESS_UNIT = 'SHARE'
 49  	AND P.OP_EMPL_MECHANISM IN ('PSA','PSC')
 50  	AND J.HR_STATUS = 'A'
 51  	AND J.POSITION_NBR LIKE 'R%'
 52  	ORDER BY 1,2,3;

View created.

SQL> /

View created.

SQL> 
SQL> create or replace PROCEDURE	     KC_ETL_USER.PRC_RPT_RFRSH_MV (MV_NAME VARCHAR2, RETURNVALUE IN OUT SYS_REFCURSOR) AUTHID DEFINER
  2  AS
  3  	BEGIN
  4  	 DBMS_MVIEW.REFRESH('KC_ETL_USER.'||MV_NAME);
  5  	 OPEN RETURNVALUE FOR SELECT 1 IS_REFRESHED, TRUNC(SYSDATE) REFRESH_DATE FROM DUAL;
  6  	END;
  7  /

Procedure created.

SQL> 
SQL> 
SQL> create or replace PROCEDURE	     KC_ETL_USER.PRC_RPT_RTRN_VW (VIEWNAME IN VARCHAR2, RETURNVALUE IN OUT SYS_REFCURSOR) AUTHID DEFINER
  2  AS
  3    table_name user_tables.table_name%type;
  4    query_str varchar2(200);
  5  	BEGIN
  6  	 table_name:= dbms_assert.sql_object_name(VIEWNAME);
  7  	 query_str := 'SELECT * FROM KC_ETL_USER.' || table_name;
  8  
  9  	 OPEN RETURNVALUE FOR query_str;
 10  
 11  	END;
 12  /

Procedure created.

SQL> 
SQL> GRANT EXECUTE ON KC_ETL_USER.PRC_RPT_RFRSH_MV TO KC_REPORTS_USER;

Grant succeeded.

SQL> GRANT EXECUTE ON KC_ETL_USER.PRC_RPT_RTRN_VW TO KC_REPORTS_USER;

Grant succeeded.

SQL> 
SQL> DROP PROCEDURE KC_ETL_USER.PRC_RPT_USAID_MONTHLY_MV;

Procedure dropped.

SQL> DROP PROCEDURE KC_ETL_USER.PRC_RPT_USAID_MONTHLY_VW;

Procedure dropped.

SQL> 
SQL> SHOW ERRORS
No errors.
SQL> SPOOL OFF
